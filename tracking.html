<input type="hidden" id="member-atid" data-ms-member="member-atid" />
<input type="hidden" id="member-msid" data-ms-member="id" />


<script>
/*
We have 1 parameter :
target-atid -> to know which element to track

Need to update automation so that member-atid is properly synced to memberstack

Might also need to update script on /all-resources page, so that it only runs if member is logged in
*/

// might need to time it better for when link is local (since it opens in the same tab)

document.addEventListener("DOMContentLoaded", () => {
console.log("In page script running!");
  window.$memberstackDom
    .getCurrentMember()
    .then(({ data: member }) => {
      if (member) {
        // get member data for recording inputs
        const memberAtid = document.querySelector("#member-atid").value;
        const memberMsid = document.querySelector("#member-msid").value;

        // Select all elements with a 'target-atid' attribute that also have a non-empty value
        const triggers = document.querySelectorAll('[target-atid]:not([target-atid=""])');

        // Iterate over the NodeList and log each element
        triggers.forEach((element) => {
          element.addEventListener("click", function (event) {
          console.log('click detected');
            // Get relevant data & add them as params to Webhook
            const targetAtid = element.getAttribute("target-atid");
            const pageUrl = window.location.href;

            const hookSlug = `993n16yk8xif1ncd50s8wol6e7sfgffb?memberATID=${memberAtid}&memberMSID=${memberMsid}&targetATID=${targetAtid}&sourcePage=${pageUrl}`;

            // Send data using fetch
            fetch(`https://hook.eu2.make.com/${hookSlug}`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
            });
          });
        });
      }
    })
    .catch((error) => {
      console.error("Error checking member status:", error);
    });
});


</script>